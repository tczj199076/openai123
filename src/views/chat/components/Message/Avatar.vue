<script lang="ts" setup>
import { computed } from 'vue'
import { NAvatar } from 'naive-ui'
import { useUserStore } from '@/store'
import { isString } from '@/utils/is'
import defaultAvatar from '@/assets/avatar.jpg'

interface Props {
  image?: boolean
}
defineProps<Props>()

const userStore = useUserStore()

const avatar = computed(() => userStore.userInfo.avatar)

const chatId = window.location.href.split('/').pop()
const localStorageKey = `prompt_${chatId}`

// 从localStorage中获取value值
const value = localStorage.getItem(localStorageKey) || undefined
const showValue = computed(() => value && value !== 'null')
</script>

<template>
  <template v-if="image">
    <NAvatar v-if="isString(avatar) && avatar.length > 0" :src="avatar" :fallback-src="defaultAvatar" />
    <NAvatar v-else round :src="defaultAvatar" />
  </template>
  <span v-else-if="showValue" class="text-[28px] ">
    <NAvatar round :src="value" />
  </span>
  <span v-else class="text-[28px] ">
    <svg t="1686880169098" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7959" width="32" height="32" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M913.066667 465.92c-13.653333 0-25.6-11.946667-25.6-25.6v-117.76c0-15.36-8.533333-30.72-22.186667-37.546667L537.6 93.866667c-13.653333-8.533333-30.72-8.533333-44.373333 0L163.84 283.306667c-13.653333 8.533333-22.186667 22.186667-22.186667 37.546666v64.853334c0 13.653333-11.946667 25.6-25.6 25.6s-25.6-11.946667-25.6-25.6v-64.853334c0-34.133333 18.773333-64.853333 47.786667-81.92L467.626667 49.493333c29.013333-17.066667 66.56-17.066667 95.573333 0L892.586667 238.933333c29.013333 17.066667 47.786667 47.786667 47.786666 81.92v117.76c-1.706667 15.36-11.946667 27.306667-27.306666 27.306667zM515.413333 988.16c-17.066667 0-32.426667-3.413333-47.786666-11.946667L138.24 785.066667c-29.013333-17.066667-47.786667-47.786667-47.786667-81.92v-109.226667c0-13.653333 11.946667-25.6 25.6-25.6s25.6 11.946667 25.6 25.6v109.226667c0 15.36 8.533333 30.72 22.186667 37.546666l329.386667 189.44c13.653333 8.533333 30.72 8.533333 44.373333 0l329.386667-189.44c13.653333-8.533333 22.186667-22.186667 22.186666-37.546666V631.466667c0-13.653333 11.946667-25.6 25.6-25.6s23.893333 10.24 23.893334 25.6v71.68c0 34.133333-18.773333 64.853333-47.786667 81.92L563.2 974.506667c-15.36 8.533333-32.426667 13.653333-47.786667 13.653333z" fill="#e6e6e6" p-id="7960" /><path d="M597.333333 645.12h-73.386666l-23.893334-71.68h-114.346666l-23.893334 71.68h-73.386666l114.346666-314.026667h78.506667L597.333333 645.12z m-110.933333-124.586667l-35.84-109.226666c-1.706667-6.826667-3.413333-15.36-5.12-27.306667H443.733333c0 8.533333-3.413333 18.773333-5.12 27.306667l-35.84 109.226666h83.626667zM704.853333 329.386667v314.026666h-66.56V329.386667h66.56z" fill="#e6e6e6" p-id="7961" /><path d="M112.64 544.426667m-69.973333 0a69.973333 69.973333 0 1 0 139.946666 0 69.973333 69.973333 0 1 0-139.946666 0Z" fill="#e6e6e6" p-id="7962" /><path d="M911.36 467.626667m-69.973333 0a69.973333 69.973333 0 1 0 139.946666 0 69.973333 69.973333 0 1 0-139.946666 0Z" fill="#e6e6e6" p-id="7963" /><path d="M814.08 646.826667V377.173333c0-23.893333-13.653333-46.08-34.133333-59.733333L546.133333 182.613333c-20.48-11.946667-47.786667-11.946667-68.266666 0l-233.813334 134.826667c-20.48 11.946667-34.133333 34.133333-34.133333 59.733333V648.533333c0 23.893333 13.653333 46.08 34.133333 59.733334L477.866667 841.386667c20.48 11.946667 47.786667 11.946667 68.266666 0l233.813334-134.826667c22.186667-11.946667 34.133333-34.133333 34.133333-59.733333z" fill="#e6e6e6" opacity=".3" p-id="7964" /></svg>
  </span>
</template>
